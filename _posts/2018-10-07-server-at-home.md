---
date: 2018-10-07 21:38:50+08:00
layout: post
title: 在家里运行服务器要考虑的功耗问题
categories: 技术随笔
tags: 网络
---

家里的网络是浙江电信100M光纤入楼，100M下载，4M上传，用来运行常见的网络服务还是没什么问题的。

我家里的设备是一块树莓派、一台三代i3台式机，一部二代i3笔记本，无线路由器是小米3A。

树莓派的功耗只有五瓦，很低，可以24小时运行。而台式机平时有五十多瓦，笔记本也要有二三十瓦。50瓦其实一年电费也就200多。每年365x24个小时，1度电（千瓦时）50瓦的设备可以运行20小时，那一年下来消耗438度电。1度电算它0.5元，一年大约220元，平均一天6毛钱。不过和树莓派差了十倍，看一年的总价还是感觉比较心疼。

树莓派其实已经可以完成大部分家用服务器任务，我平时也只会测试一些应用。但是用来跑stanford corenlp时性能就不够了，而转换indesign为pdf需要windows或者osx系统，对性能要求也不低。这时像mac mini这样的设备是很合适的，性能足够，而且haswell架构的mac mini 2014闲置时只有6w功耗。我还看了很多su9400的本子以及atom的mini主机，但性能都比较孱弱。

我手头的台式机功耗高了点，而笔记本散热是个问题。台式机用的技嘉h61还不支持睡眠唤醒（wol, wake on lan）。

开启睡眠唤醒的话，平时计算机没有请求就进入睡眠模式，但给网卡单独通电，之后可以通过其它设备对其发送幻数据包（magic packet）来进行唤醒（睡眠时设备是ping不通的），可以省电。需要在bios开启这一功能，然后windows的话在设备管理器的有线网卡的设置里允许该设备唤醒计算机，mac在节能的设置里开启允许网络唤醒。如果想从外网进行远程唤醒，还要设置动态域名，并开放一个端口，然后向任意端口发送一个udp包就行，代码可以参考以下网站：[低碳mini: Apple Remote & Wake On LAN](https://www.douban.com/note/56568076/)。不过现在家里设备都是通过无线连接的，但支持无线局域网唤醒的设备并不多。

另外对于硬件不支持局域网睡眠唤醒的台式机，我还想了个办法，就是用树莓派控制舵机按电源键或者连接着的键盘。



